# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами


## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды
```
npm install
npm run start
```
или
```
yarn
yarn start
```
## Сборка
```
npm run build
```
или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Данные карточки товара

```
interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: ProductCategory;
    price: number | null;
}
```

Ошибки в форме
```
type FormErrors = {
	email?: string;
	phone?: string;
	address?: string;
	payment?: string;
}
```

Пользовательские данные

```
interface IUserData {
    adress: string;
    email: string;
    phone: string;
    payment: string;
    getUserData(): IUserData; - данные пользователя для заказа
    checkUserInfoValidation(data: Record<keyof TContactInf, string>): boolean; - проверка корректности данных пользователя
}
```

Интерфейс для данных заказа

```
interface IOrder {
    address: string;
    phone: number;
    payment: OrderPayment;
    mail: string;
    total: number | null;
    items: IProduct[]
    errors: FormErrors
}
```

Результат заказа
```
interface IOrderResult {
    id: string
    total: number | null;
}
```

Интерфейс корзины товаров
```
interface IBasket {
    basket: TBasket[];
    resetBasket(): void - очищение данных после успешного заказа
}
```

Интерфейс открытой карточки товара для просмотра
```
interface IExploreCard {
     items: IProduct[];
    preview: string | null;
}
```
Интерфейс каталогa товаров
```
interface IListItem {
    items: TMainCards[]; - массив карточек на главной странице
    preview: string | null; - id открытой карточки
    showOneItem(item: string): void; - открываем карточку для просмотра по id 
    getItems(): IProduct[]; - получаем массив карточек с сервера
    saveItems(): IProduct[]; - сохраняем массив карточек
}
```

// Отображение продукта на главной странице
```
type TMainCards = Omit<IProduct, "description">
```

Данные карточки, используемые в модальном окне корзины

```
type TBasket = Pick<IProduct, 'id' | 'title' | 'price'>
```

Выбор способа оплаты
```
type OrderPayment = "online" | "cash"
```

Способ оплаты и адрес пользователя

```
type TPayment = Pick<IOrder, 'payment' | 'address'>
```

Контактные данные пользователя: почта и телефон

```
type TContactInf = Pick<IOrder, 'mail' | 'telephone'>
```

Тип открытого модального окна 
```
type AppStateModal = "product" | "basket" | "order"
```

## Архитектура приложения

Код приложения разделёна на слои согласно парадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных,
- презентер, отвечает за связь представления в данных.

### Базовый код

#### Класс Api 
Содержит в себе базовую логику отправки запросов. В конструкотор передаётся базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределён заданием третьего параметра при вызове.

- **Api**
Класс, представляющий базовый API-клиент, который включает в себя методы для отправки GET и POST запросов:

```ts
class Api {
	//Конструктор класса принимает базовый URL и дополнительные опции для запросов
	constructor(baseUrl: string, options: RequestInit = {});

	//Метод, который обрабатывает ответы от сервера
	protected async handleResponse(response: Response): Promise<Partial<object>>;

	// Get запрос
	async get(uri: string);

	// Post запрос
	async post(uri: string, data: object);
}
```
#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные метода, реализуемые классом описаны интерефейсом `IEvents`:
- `on` - подписка на событие 
- `emit` - инициализация события 
- `trigger` - возвращает функцию, при вызове котороой инициализируется требуемое в параметрах событие

### Слой данных

### класс `ItemsData`

Отвечает за данные и логику работы с данными товаров\
Функция-конструктор принимает инстанс брокера событий\

- `constructor(events: IEvents): void`

Содержит поля: 

- `_items: IProduct[];` хранит массив карточек
- `_preview: string | null;` id открытой для просмотра карточки
- `events: IEvents;` экземпляр класса EventEmitter для генерации событий при изменении данных (хранится в каждом классе)

Методы класса для взаимодействия с данными: 

- `getBasketProducts(item: string): TBasket[]` - получение товаров в корзине
- `showOneItem(item: string): IProduct;`  возвращает объект открытой карточки для просмотра по id 
- `getCards(): IProduct[];`  получаем массив карточек с сервера
- `saveCards(): IProduct[];`  сохраняем массив карточек
- `функции get(), set();`  для доступа и работы со свойствами объекта-инстанса этого класса

### класс `UserData`

Отвечает за данные пользователя и логику работы с ними\
Функция-конструктор принимает инстанс брокера событий\

- `constructor(events: IEvents): void`

Содержит поля: 

- `_adress: string;` хранит данные адреса пользователя
- `_email: string;`  хранит данные почты пользователя
- `_phone: string;`  хранит данные номера телефона пользователя
- `_payment: string;` хранит данные выбранного способа оплаты пользователя
- `events: IEvents;` экземпляр класса EventEmitter для генерации событий при изменении данных (хранится в каждом классе)

Методы класса для взаимодействия с данными: 

- `getUserData(): IUserData;`  возвращает объект с данными пользователя
- `checkUserInfoValidation(): boolean;`
- функции `get(), set();` для доступа и работы со свойствами объекта-инстанса этого класса

### класс `BasketData`

Отвечает за работу с корзиной покупок\
Функция-конструктор принимает инстанс брокера событий\

- `constructor(events: IEvents): void`

Содержит поля: 
- `basket: IProduct[];`  список товаров в корзине
- `events: IEvents;` экземпляр класса EventEmitter для генерации событий при изменении данных (хранится в каждом классе)

Методы класса для взаимодействия с данными: 

- `addItemToBasket(item: string, payload: Function | null): void;` добавляем товар по id в корзину
- `deleteItemFromBasket(item: string, payload: Function | null): void;`  удаляем товар по id из корзины
- `getTotalPrice(): number | null` - получение стоимости всей корзины
- `clearOrder(): void` - очищаем текущий заказ
- `resetBasket(): void;` очищение данных после успешного заказа
- функции `get(), set();`  для доступа и работы со свойствами объекта-инстанса этого класса

### Классы представлений
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных. 

### класс Component 

*Абстрактный!* класс `Component` служит шаблоном для создания компонентов, которые будут работать с элементами DOM. Он позволяет определять общую функциональность для всех компонентов, а также обязывает подклассы реализовать определенные в нем методы. Такой подход помогает в организации и повторном использовании кода.

- `constructor(container: HTMLElement);`

Mетоды:

- `toggleClass(element: HTMLElement, className: string, force?: boolean): void` переключает класс (если есть-удаляет, если нет - добавляет)
- `setText(element: HTMLElement, value: unknown): void` добавляет указанный текст в разметку элемента
- `setDisabled(element: HTMLElement, state: boolean): void` переключает состояние элемента
- `setHidden(element: HTMLElement): void` скрывает элемент
- `setVisible(element: HTMLElement): void` делает элемент видимым
- `render(data?: Partial<T>): HTMLElement` возвращает корневой элемент


### класс `Card`

Отвечает за отображение карточек на главной странице, в модальном окне просмотра карточки, в корзине. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки карточки. \
Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\

- `constructor(card: HTMLElement, ivent: IEvents)`

Реализует методы:

- `setData(cardData: IProduct): void;` заполняет данными элементы карточки
- `getCard(card: object): HTMLElement;` возвращает заполненную данными карточку
- `getIdCard(card: object): string`  возвращает id карточки
- `set()` - для передачи данных для отображения 

### класс `Main`

Отвечает за отображение блока с карточками на главной странице. В конструктор принимает контейнер, в котором размещаются карточки. В метод render принимает массив элементов разметки карточек, который отображает в контейнере, за который отвечает.

- `constructor(conteiner: HTMLElement)`

### класс `ModalPopUp` 

Класс модального окна. Предоставляет методы `open` и `close`, а также слушатели закрытия модального окна при клике на клавишу esc, overlay, кнопку с срестиком.

Конструктор принимает селектор, по которому в разметке будет найдено необходимое модальное окно и экземпляр класса EventEmitter для инициации событий 

- `constructor(selector: string, events: IEvents);`

Содержит поля:

- `modal: HTMLElement;` 
- `events: IEvents;`

Реализует методы:

- `openPopupWindow(): void;`
- `closePopupWindow(): void;`
- `addContentToPopupWindow(template: HTMLElement): void;` заполнение модального окна контентом


### класс `BasketPopUp` 

Отвечает за отображениие выбранных товаров в корзине

Содержит поля:
- `basketList: HTMLListElement;` список товаров 
- `submitButton: HTMLButtonSubmit;` кнопка подтверждения
- `totalSum: HTMLElement;` элемент для отображения общей стоимости товаров 

Реализует метод:

- `showCards(card: HTMLElement): void;` добавляет элемент карточки в список корзины


### класс `FormsPopUp`

Отвечает за работу с полями ввода формы. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в поле ввода - инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. 

Содержит поля:
- `submitButton: HTMLButtonElement;` кнопка подтверждения
- `formName: string;` значение атрибута name формы
- `form: HTMLElement;` элемент формы
- `inputs: [];` список инпутов формы
- `errors: Record<string, HTMLElement>;`  объект, хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту nam

Реализует методы:


- `setValid(isValid: bolean): void;` изменяет активность кнопки подтверждения 
- `getInputValues(): Record<string, string>;` возвращает объект с данными формы. Ключ - значение атрибута name элемента формы, value - пользовательское значение. 
- `setError(data: { field: string, value: string, validInformation: string }): void;` принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- `showInputError (field: string, errorMessage: string): void;` отображает полученный текст ошибки под указанным полем ввода
- `hideInputError (field: string): void;` очищает текст ошибки под указанным полем ввода
- `close (): void;` закрывает модалку и очищает поля формы 
- `get (form: HTMLElement);` геттер для получения элемента формы


### класс `SucessOrderPopup` 

Отвечает за отображение модального окна после успешного завершения заказа. 

Содержит поля: 
- `submitButton: HTMLElement;` кнопка возврата к списку товаров
- `totalSum: HTMLElement;` элемент для отображения общей стоимости заказа
- 
Реализует метод:
- `goBackToMainPage(): void;` закрывает модальное окно, очищает корзину

# Коммуникационный слой
Отвечает за взаимодействие с сервером\
Все взаимодействие строится на работе с событиями
получаем данные -> генерируем события -> выполняем действия\
данные в модели изменяются -> генерируем событие -> выполняем действия

### Класс `AppApi`
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
- `constructor()`

## Взаимодействие компонентов

Код, описывающий взаимодействие слоя представления и слоя данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*

- `CardsData:changed` - изменение массива карточек
- `CardData:selected` - изменение данных открываемой в модальном окне карточки
- `basketData:changed` - изменение данных в корзине товаров
- `userData:changed` - изменение данных пользователя при заполнении формы
- `itemsDatap:reviewClear` - очистка модального окна просмотра выбранной карточки от данных 

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*

- `card:open` - открытие карточки для просмотра
- `card:added` - клик по кнопке добавления товара в корзину
- `modal:close` - клик на иконку закрытия модального окна/клик на кнопку в модальном окне успешного заказа для перехода на главную
- `card:delete` - клик на иконку удаление товара из корзины
- `edit-adress:input` - редактирование данных в поле адреса
- `edit-payment:changed`- редактирование способа оплаты
- `edit-email:input` - редактирование даннх в поле почты
- `edit-phone:input` - редактирование данных в поле телефона
- `form-payment:submit` - клик на кнопку далее в модальном окне со способом оплаты
- `form-userdata:submit` - клик на кнопку далее в модальном окне с данными пользователя
- `form-payment:validation` - событие необходимости валидации всей формы с данными способа оплаты (влияет на активность кнопки)
- `form-userdata:validation` - событие необходимости валидации всей формы с данными юзера (влияет на активность кнопки)
- `basket:validation`- событие необходимости валидировать, что в корзине есть товары